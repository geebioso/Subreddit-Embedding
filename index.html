<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Subreddit Similarity MDS Test</title>
        <script type="text/javascript" src="//d3js.org/d3.v3.min.js"></script>
	<style type="text/css">
			div.bar {
				display: inline-block;
				width: 20px; 
				height: 75px; 
				background-color: teal; 
				margin-right: 2px; 
			}
	</style>
    </head>
    <body>
	<h1> Subreddit Embeddings </h1>
	<div id = "srdiv">
	<select onchange="loadData()" id = "whembedding" font-family ="sans-serif">
		<option> MDS </option>
		<option> tSNE </option>
	</select>
	</div>
        <script type="text/javascript">
		var divname = "srdiv";
		var margin = {top: 20, right: 20, bottom: 30, left: 200},
		    width = 600,
		    height = 600;
		var xpadding = 50,
			ypadding = 50;  
		var x = d3.scale.linear()
		    .range([xpadding, width-xpadding]);
		var y = d3.scale.linear()
		    .range([height- ypadding, ypadding]);
		var color = d3.scale.category20c();
		
		var svg = d3.select("body").append("svg")
			.attr('width', width)
			.attr('height', height); 
		var controls = d3.select("#"+divname).append("label")
		        .attr("id", "controls");
		//var checkbox = controls.append("input")
		//   	.attr("id", "collisiondetection")
		//    	.attr("type", "checkbox")
		//controls.append("span")
		//	.text("Remove Overlap")
		//	.attr("style", "font-family:helvetica; font-size:10pt");

		//var checkbox = controls.append("input")
		//    	.attr("id", "typeofdata")
   		//     	.attr("type", "checkbox");
		
		//d3.select('input').on('change', loadData()); 
		function loadData(){


			var embed = document.getElementById('whembedding').selectedOptions[0].text;
			filename = "DSMsubredditSimilarity" + embed + ".txt";
			d3.select("h1").text("Subreddit Embedding " + embed); 

			d3.tsv(filename, function(error, data) {
				
				x.domain(d3.extent(data, function(d) { return +d.dim1; })).nice();
				y.domain(d3.extent(data, function(d) { return +d.dim2; })).nice();
					
				  var force = d3.layout.force()
				         .nodes(data)
				         .size([width, height])
				         .on("tick", tick)
				       	 .charge(-1)
		        		 .gravity(0)
				         .chargeDistance(20);

				var text = svg.selectAll("text").data(data)
				text.enter().append("text")
				text.exit().remove()
				text.text( function(d) {
						return( d.subreddit ); 
					})
					.attr("x", function(d) {
						return(x(d.dim1));
					})	
					.attr("y", function(d) {
						return(y(d.dim2));
					})
					.attr("font-family", "sans-serif")
					.attr("font-size", "11px");
					
				var twidth 				

				svg.selectAll("text").data(data).exit().remove(); 
		
				d3.select("#collisiondetection").on("change", function() {
       					force.resume();
				});
				    function tick(e) {
				        text.each(moveTowardDataPosition(e.alpha));
				
				         if (checkbox.node().checked) text.each(collide(e.alpha));
				
				        text.attr("x", function(d) { return d.dim1; })
				            .attr("y", function(d) { return d.dim2; });
				    }
				
				    var damper = .2;
				    function moveTowardDataPosition(alpha) {
				        return function(d) {
				            d.dim1 += (x(d.dim1) - d.dim1) * 0.1 * alpha;
				            d.dim2 += (y(d.dim2) - d.dim2) * 0.1 * alpha;
				
				        };
				    }
				
				    // Resolve collisions between nodes.
				    function collide(alpha) {
				        var quadtree = d3.geom.quadtree(data);
				        return function(d) {
				            var r = d.radius + radius + padding,
				                nx1 = d.dim1 - r,
				                nx2 = d.dim1 + r,
				                ny1 = d.dim2 - r,
				                ny2 = d.dim2 + r;
				            quadtree.visit(function(quad, x1, y1, x2, y2) {
				                if (quad.point && (quad.point !== d)) {
				                    var x = d.dim1 - quad.point.x,
				                        y = d.dim2 - quad.point.y,
				                        l = Math.sqrt(x * x + y * y),
				                        r = d.radius + quad.point.radius + (d.color !== quad.point.color) * padding;
				                    if (l < r) {
				                        l = (l - r) / l * alpha;
				                        d.dim1 -= x *= l;
				                        d.dim2 -= y *= l;
				                        quad.point.x += x;
				                        quad.point.y += y;
				                    }
				                }
				                return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
				            });
				        };
				    }
			 });

		} 
		loadData()
        </script>
    </body>
</html>
